<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Judge Assignment — Right Panel to Rings</title>
<style>
  :root{--ring-w:220px;--ring-h:240px;--gap:16px;--bg:#0b1220;--ink:#e6ecff;--muted:#a6b3d1;--accent:#5b8cff;--ok:#5de0a8;--danger:#ef4444}
  *{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--ink);background:var(--bg);display:grid;grid-template-rows:auto 1fr;gap:14px;padding:14px;overflow-x:hidden}
  header{display:grid;grid-template-columns:1fr auto auto auto auto;gap:10px;align-items:center}h1{font-size:18px;margin:0;font-weight:800}.tname{display:flex;align-items:center;gap:8px}.tname input{width:360px;max-width:100%;background:#0b1b3a;color:var(--ink);border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:10px 12px;font-weight:800}
  button,label.btn{border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;background:#1b2848;color:var(--ink)}button.primary{background:var(--accent);color:#fff}input[type=file]{display:none}.meta{color:var(--muted);font-size:13px;margin-left:6px}
  .stage{display:grid;grid-template-columns:3fr 1fr;gap:14px;min-height:min(82vh,860px);width:100%}
  .grid{position:relative;border-radius:12px;background:#0a132a;padding:12px;overflow:auto}.grid-mesh{display:grid;gap:var(--gap);grid-auto-rows:var(--ring-h);grid-template-columns:repeat(3,minmax(0,var(--ring-w)))}.ring{width:var(--ring-w);height:var(--ring-h);background:#0f1b39;border-radius:14px;padding:10px;display:grid;grid-template-rows:auto auto 1fr;border:1px solid rgba(255,255,255,.08);box-shadow:inset 0 0 0 1px rgba(255,255,255,.04)}.ring-id{font-size:15px;font-weight:800;color:#cfe3ff}.ring-meta{display:grid;grid-template-columns:1fr;gap:6px}.ring-division,.ring-category{background:#0d1633;border:1px solid rgba(255,255,255,.06);color:var(--ink);border-radius:8px;padding:6px 8px;font-weight:700;min-width:0}.slots{display:grid;grid-template-rows:repeat(3,1fr);gap:8px;margin-top:6px}.slot{position:relative;border-radius:10px;background:rgba(255,255,255,.05);border:1px dashed rgba(255,255,255,.18);display:grid;place-items:center;color:var(--muted);font-size:12px;text-align:center;padding:6px}.slot[data-active=true]{outline:2px solid var(--accent);outline-offset:-2px}.slot[data-filled=true]{border-style:solid;border-color:rgba(255,255,255,.28);color:#cfe3ff}.slot .clear{position:absolute;top:6px;right:6px;width:22px;height:22px;border-radius:6px;background:#1b2848;color:#fff;border:1px solid rgba(255,255,255,.15);font-size:14px;line-height:18px;display:none;cursor:pointer}.slot[data-filled=true] .clear{display:inline-grid;place-items:center}
  .tray{position:relative;background:#0d1a36;border-radius:12px;padding:12px;overflow:hidden;display:grid;grid-template-rows:auto auto 1fr;gap:10px;min-width:0}.tray-header{display:flex;gap:8px;align-items:center;justify-content:space-between;min-width:0}.tray-title{font-size:14px;color:var(--muted);font-weight:700}.search{display:grid;grid-template-columns:1fr auto auto;gap:8px;min-width:0}.search input,.search select{background:#0b1b3a;color:var(--ink);border:1px solid rgba(255,255,255,.12);border-radius:8px;padding:8px;font-weight:700;min-width:0}.tray-scroll{position:relative;overflow-y:auto;overflow-x:hidden;border-radius:10px;background:#0b1b3a;padding:10px;min-height:0;scrollbar-gutter:stable both-edges;overscroll-behavior:contain}.tray-area{position:relative;min-height:100%;overflow:visible}.tile{position:absolute;width:calc(100% - 16px);min-height:66px;border-radius:10px;cursor:grab;user-select:none;touch-action:none;background:linear-gradient(180deg,#b4c5ff,#7da7ff);box-shadow:0 8px 18px rgba(0,0,0,.35),inset 0 0 0 2px rgba(0,0,0,.08);display:grid;grid-template-columns:1fr auto;gap:6px;align-items:center;padding:8px 10px;left:8px;box-sizing:border-box}.t-name{font-weight:900;color:#0b1024;line-height:1.1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.t-rank{font-size:12px;font-weight:700;color:#0b1024;opacity:.85}.t-id{font-size:10px;opacity:.8}.t-division{font-size:11px;font-weight:800;background:rgba(255,255,255,.7);color:#0b1024;padding:2px 6px;border-radius:8px;justify-self:end}.tile[data-placed=true]{background:linear-gradient(180deg,#7dfcce,#5de0a8)}.tile[data-competing=true]{filter:grayscale(1) brightness(.85);box-shadow:0 0 0 2px var(--danger) inset;cursor:not-allowed}
</style>
</head>
<body>
<header>
  <div class="tname"><h1>Judge Assignment — Right Panel to Rings</h1><input id="tournamentName" placeholder="Tournament name…"/></div>
  <button id="newBtn" class="primary">New Rings</button>
  <button id="addJudgeBtn" class="btn">Add Judge</button>
  <label class="btn" for="csvInput">Import Judges (CSV)</label><input id="csvInput" type="file" accept=".csv"/>
  <div style="display:flex;gap:8px"><button id="saveBtn" class="btn">Save</button><button id="loadBtn" class="btn">Load</button></div>
  <span class="meta" id="meta"></span>
</header>
<div class="stage">
  <div class="grid"><div class="grid-mesh" id="gridMesh"></div></div>
  <aside class="tray">
    <div class="tray-header"><div class="tray-title">Judges (drag →)</div></div>
    <div class="search"><input id="searchBox" placeholder="Search judges by name…"/><button id="clearSearch" class="btn">Clear</button><select id="rankFilter"><option value="all">All judges</option><option value="masters">Masters (6+)</option><option value="5">5th Degree</option><option value="4">4th Degree</option><option value="3">3rd Degree</option><option value="2">2nd Degree</option><option value="1">1st Degree</option></select></div>
    <div class="tray-scroll"><div class="tray-area" id="trayArea"></div></div>
  </aside>
</div>
<script>
(function(){
let rows=0,cols=0,rings=0;const SLOTS_PER_RING=3;let slotsOccupied=[];let tiles=new Map();let idCounter=1;const meshEl=document.getElementById('gridMesh');const trayArea=document.getElementById('trayArea');const metaEl=document.getElementById('meta');const searchBox=document.getElementById('searchBox');const clearSearchBtn=document.getElementById('clearSearch');const rankFilter=document.getElementById('rankFilter');const addJudgeBtn=document.getElementById('addJudgeBtn');const tNameEl=document.getElementById('tournamentName');let ringDivisions=[],ringDivisionsNorm=[],ringCategories=[];
function normalizeDivision(s){return(s||'').toString().trim().replace(/\s+/g,'').toUpperCase()}
function levelFromEligibility(sel){switch((sel||'').toLowerCase()){case'tiger':return 0;case'color':return 1;case'1 degree':return 1;case'2/3 degree':return 2;case'4/5 degree':return 4;case'6+ degree':return 6;default:return 6}}
function judgeEligibleFor(cat,level){switch(cat){case'Tiger':return level>=1;case'Color':return level>=1;case'1 Degree':return level>=2;case'2/3 Degree':return level>=2;case'4/5 Degree':return level>=4;case'6+ Degree':return level>=6;default:return true}}
function newLayout(){const rStr=prompt('How many rings?','12');if(rStr===null)return;rings=Math.max(1,parseInt(rStr,10)||0);cols=Math.min(3,Math.ceil(Math.sqrt(rings)));rows=Math.ceil(rings/cols);renderGrid(rows,cols,rings);slotsOccupied=new Array(rings*SLOTS_PER_RING).fill(null);tiles.forEach(t=>returnToTray(t));layoutTray();metaEl.textContent=`Rings: ${rings} · Grid: ${rows}×${cols}`}
function renderGrid(r,c,total){meshEl.innerHTML='';ringDivisions=new Array(total).fill('');ringDivisionsNorm=new Array(total).fill('');ringCategories=new Array(total).fill('Color');for(let i=0;i<total;i++){const ring=document.createElement('div');ring.className='ring';const idDiv=document.createElement('div');idDiv.className='ring-id';idDiv.textContent=`Ring ${i+1}`;const meta=document.createElement('div');meta.className='ring-meta';const divInput=document.createElement('input');divInput.className='ring-division';divInput.placeholder='Division code';divInput.addEventListener('input',()=>{ringDivisions[i]=divInput.value;ringDivisionsNorm[i]=normalizeDivision(divInput.value);recomputeCompeting();layoutTray()});const catSel=document.createElement('select');catSel.className='ring-category';['Tiger','Color','1 Degree','2/3 Degree','4/5 Degree','6+ Degree'].forEach(v=>{const o=document.createElement('option');o.value=v;o.textContent=v;catSel.appendChild(o)});catSel.value='Color';catSel.addEventListener('change',()=>{ringCategories[i]=catSel.value;layoutTray()});meta.append(divInput,catSel);const slots=document.createElement('div');slots.className='slots';for(let s=0;s<SLOTS_PER_RING;s++){const slot=document.createElement('div');slot.className='slot';slot.dataset.ring=i;slot.dataset.slot=s;slot.textContent=`Judge slot ${s+1}`;const clear=document.createElement('button');clear.className='clear';clear.type='button';clear.textContent='×';slot.append(clear);slots.append(slot)};ring.append(idDiv,meta,slots);meshEl.append(ring)}slotsOccupied=new Array(total*SLOTS_PER_RING).fill(null)}
function spawnJudge(name,rank,division,elig){const id=`J${idCounter++}`;const el=document.createElement('div');el.className='tile';trayArea.append(el);const divText=(division||'').trim();const eligText=(elig||'').trim();const state={id,name,rank,division:divText,divNorm:normalizeDivision(divText),eligibility:eligText,level:levelFromEligibility(eligText),el,placed:false,slotIndex:-1,startLeft:10,startTop:10};tiles.set(id,state);el.innerHTML=`<div><div class='t-name'>${name}</div><div class='t-rank'>${rank||''}</div></div><div class='t-id'>${divText?`<span class='t-division'>${divText}</span>`:''}${eligText?` <span class='t-division'>${eligText}</span>`:''}</div>`;enableDrag(state);layoutTray()}
function returnToTray(tile){tile.placed=false;tile.slotIndex=-1;tile.el.dataset.placed='false'}
function layoutTray(){const q=(searchBox.value||'').toLowerCase().trim();const rf=(rankFilter&&rankFilter.value)||'all';let y=10;const parent=trayArea.parentElement;const styles=getComputedStyle(parent);const usableW=parent.clientWidth-parseFloat(styles.paddingLeft)-parseFloat(styles.paddingRight)-16;tiles.forEach(t=>{if(t.placed)return;const lvl=t.level;const matchName=!q||(t.name&&t.name.toLowerCase().includes(q));const matchRank=rf==='all'?true:(rf==='masters'?lvl>=6:lvl===parseInt(rf));const match=matchName&&matchRank;t.el.style.display=match?'grid':'none';if(match){t.el.style.width=usableW+'px';t.el.style.left='8px';t.el.style.top=y+'px';y+=(t.el.offsetHeight||66)+10}})}
function enableDrag(tile){let sx,sy,ox,oy,drag=false;const down=e=>{e.preventDefault();tile.el.setPointerCapture(e.pointerId);drag=true;sx=e.clientX;sy=e.clientY;const r=tile.el.getBoundingClientRect(),p=tile.el.offsetParent.getBoundingClientRect();ox=r.left-p.left;oy=r.top-p.top;tile.el.style.zIndex=1000};const move=e=>{if(!drag)return;const dx=e.clientX-sx,dy=e.clientY-sy;tile.el.style.left=ox+dx+'px';tile.el.style.top=oy+dy+'px'};const up=e=>{if(!drag)return;drag=false;tile.el.releasePointerCapture(e.pointerId);trySnap(tile,e.clientX,e.clientY)};tile.el.addEventListener('pointerdown',down);window.addEventListener('pointermove',move);window.addEventListener('pointerup',up)}
function trySnap(tile,x,y){const s=document.elementFromPoint(x,y);const slot=s&&s.classList&&s.classList.contains('slot')?s:null;if(!slot)return;const idx=parseInt(slot.dataset.ring)*SLOTS_PER_RING+parseInt(slot.dataset.slot);const cat=ringCategories[parseInt(slot.dataset.ring)]||'Color';if(!judgeEligibleFor(cat,tile.level)){alert('Judge rank not eligible for this ring');return false}if(slotsOccupied[idx])return false;if(tile.placed&&tile.slotIndex!=-1){slotsOccupied[tile.slotIndex]=null}slotsOccupied[idx]=tile.id;tile.placed=true;tile.slotIndex=idx;slot.dataset.filled='true';slot.textContent=`${tile.name}${tile.rank?' — '+tile.rank:''}`;const clear=document.createElement('button');clear.className='clear';clear.textContent='×';slot.append(clear);layoutTray();return true}
meshEl.addEventListener('click',e=>{const btn=e.target.closest('.clear');if(!btn)return;const slot=btn.closest('.slot');const idx=parseInt(slot.dataset.ring)*SLOTS_PER_RING+parseInt(slot.dataset.slot);const id=slotsOccupied[idx];if(!id)return;const t=tiles.get(id);slotsOccupied[idx]=null;slot.dataset.filled='false';slot.textContent=`Judge slot ${parseInt(slot.dataset.slot)+1}`;const again=document.createElement('button');again.className='clear';again.textContent='×';slot.append(again);returnToTray(t);layoutTray()})
addJudgeBtn.addEventListener('click',()=>{const n=prompt('Judge name:');if(!n)return;const r=prompt('Rank:')||'';const d=prompt('Division:')||'';const e=prompt('Eligibility:')||'';spawnJudge(n,r,d,e)})
searchBox.addEventListener('input',layoutTray);rankFilter.addEventListener('change',layoutTray);clearSearchBtn.addEventListener('click',()=>{searchBox.value='';rankFilter.value='all';layoutTray()});document.getElementById('newBtn').addEventListener('click',newLayout);
(function init(){rings=12;cols=Math.min(3,Math.ceil(Math.sqrt(rings)));rows=Math.ceil(rings/cols);renderGrid(rows,cols,rings);metaEl.textContent=`Rings: ${rings} · Grid: ${rows}×${cols}`})();})();
</script>
</body>
</html>
